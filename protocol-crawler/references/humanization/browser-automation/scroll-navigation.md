# 滚动与浏览拟人 (Scrolling & Navigation)

滚动条是很多初级pc暴露的地方（直接 `window.scrollTo` 是大忌）。

## 1. 惯性滚动 (Inertial/Kinetic Scrolling)

只有低级的pc才会使用 `window.scrollBy(0, 100)`。现代操作系统和硬件都赋予了滚动操作"质量"和"摩擦力"。

### 1.1 物理模型：指数衰减 (Exponential Decay)

真人拨动滚轮或触摸板时，给予的是一个初始冲量 (Impulse)，随后页面在摩擦力作用下减速。

**算法核心**：

```
V_t = V_0 × e^(-k × t)
```

- V_0: 初始速度（由手指拨动的力度决定，是一个随机范围值）
- k: 摩擦系数（模拟浏览器或操作系统的阻尼感）
- t: 时间增量

**实现细节（Event Loop）**：

你不能只改变 scrollTop。你必须密集地触发 wheel 事件序列。

1. **启动阶段 (0-100ms)**：deltaY 迅速增加（如 10 -> 30 -> 60）
2. **惯性阶段 (100ms-end)**：deltaY 根据指数衰减公式逐渐变小（60 -> 55 -> 48 ... -> 2 -> 0）

**浮点数陷阱**：

- 触摸板：deltaY 往往是浮点数（如 12.532）
- 鼠标滚轮：deltaY 通常是固定步长的倍数（如 100 或 120）
- 混用会导致zw不匹配

### 1.2 采样率与微颤

时间间隔不是固定的。在 16ms (60Hz) 间隔基础上，叠加一个 ±2ms 的高斯噪声。模拟了操作系统调度器和浏览器渲染线程的微小延迟。

### 1.3 橡皮筋效果 (Rubber-banding)

在 macOS 或移动端，当滚动到底部或顶部时，页面不会"死"在那里，而是会被"拉"过界一点点，然后弹回来。

**顶级拟人**：如果你的 User-Agent 伪装是 Mac/iPhone，但在到达底部时直接硬刹车，这是逻辑漏洞。

## 2. 阅读节奏 (Reading Patterns)

通过分析内容密度来决定滚动的行为。机器看代码，人看内容。

### 2.1 视觉锚点逻辑 (Visual Anchor Logic)

普通的拟人脚本是随机停顿。顶级的拟人脚本是"基于 DOM 结构"的停顿。

**解析 DOM**：脚本在滚动前，先分析页面的 HTML 结构，找出 H1, H2, img, video, table 等高权重元素的位置。

**行为映射**：
| 内容类型 | 行为 |
|----------|------|
| 纯文本区域 | 匀速慢滚（约 200-500 wpm） |
| 图片/图表 | 当大图进入视口中心时，立刻停止滚动，停留 1.5s - 3s |
| 标题 (Header) | 在标题处稍微减速，确认章节内容，然后加速划过 |

### 2.2 动态阅读速度 (Variable Reading Speed)

人眼不是扫描仪。

| 阶段 | 速度 | 原因                                        |
| ---- | ---- | ------------------------------------------- |
| 开头 | 慢   | 刚打开页面或刚进入新章节，建立上下文        |
| 中间 | 快   | 确认内容不感兴趣或在寻找特定信息 (Skimming) |
| 结尾 | 慢   | 接近文章结论或评论区                        |

**技术实现**：将页面分为若干个 Section，为每个 Section 分配不同的 Base_Speed 权重。

### 2.3 回滚机制 (Back-tracking)

这是区分"采集器"和"读者"的最强特征。

**短期回滚 (Short-term Rewind)**:

- 场景：看到一半，突然想确认上一段的某个词
- 动作：向上滚动约 1/3 个视口高度，停留 2秒，再继续向下
- 触发概率：基于"内容复杂度"。如果某段文字包含大量数字或专业术语，触发回滚的概率应提升至 30%-40%

**矫正**：每向下滚动 3-5 次大幅度动作，必须穿插 1 次微小的向上修正。

## 3. 鼠标与滚动的协同

### 3.1 避让原则 (Avoidance Principle)

当用户开始长距离阅读（滚动）时，他们会把鼠标移开以避免视觉遮挡。

**实现**：检测到连续滚动动作开始时，生成一个平滑轨迹，将鼠标移动到页面两侧的空白区域或右侧滚动条附近。

### 3.2 辅助阅读 (Reading Guide)

约 15% 的用户会用鼠标光标"指着"正在读的那行字，水平跟随文字移动，然后垂直下降。

### 3.3 文本选区抖动 (Selection Jitter)

许多用户有"多动症"，会在阅读时无意识地选中一段文字，然后点击空白处取消。

**实现**：在停留阶段，随机触发 `mousedown -> 拖拽 20px -> mouseup -> click body`。这种"毫无意义"的操作是信任度加分的关键。

## 4. 浏览器渲染层细节

### 4.1 懒加载触发 (Lazy-load Triggering)

**问题**：很多网站的图片是懒加载的。如果pc滚得太快，图片还没渲染出来就滚过去了。

**拟人策略**：必须监控 Network 状态。在快速滚动时，如果检测到大量 Pending 的图片请求，强制暂停滚动，等待至少 50% 的资源加载完成。

## 技术栈清单

| 组件     | 实现方式                                                                      |
| -------- | ----------------------------------------------------------------------------- |
| 物理公式 | `v = v_0 × e^(-kt)` 生成 wheel 事件的 deltaY 序列                             |
| DOM 分析 | 获取关键元素 (h1, img) 的 boundingClientRect 作为滚动"关键帧"                 |
| 状态机   | `Idle -> Accelerating -> Cruising -> Decelerating -> Reading -> Backtracking` |
